{% extends 'home/base.html.twig' %}

{% block title %}Documentation{% endblock %}
{% block navbar_title %}Documentation{% endblock %}

{% block body_content %}

    <link rel="stylesheet" href="{{ asset('assets/css/highlightStyles/darcula.css') }}">

    <style>
        .td-method {
            text-align: center;
            font-weight: bold;
        }
        .td-get {
            background-color: #3CAAB5;
        }
        .td-post {
            background-color: #78BC61;
        }
        .td-delete {
            background-color: #ED6A5A;
        }
        .td-put {
            background-color: #E6C229;
        }
    </style>
    <div class="container">

        <div class="card">
            <div class="card-header">
                <h4>Power Strip</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <h5>JSON Struct</h5>
                        <p>
                            {<br>
                            &nbsp;&nbsp;"id" : Integer Unique AutoGenerated,<br>
                            &nbsp;&nbsp;"name" : String Require,<br>
                            &nbsp;&nbsp;"plugs" : Plug[], <small class="text-info">#Power strip's plugs</small> <br>
                            }
                        </p>
                    </div>
                    <div class="col-md-12">
                        <h5>Rooting</h5>
                        <table class="table table-bordered">
                            <tbody>
                            <tr>
                                <td class="td-get td-method">GET</td>
                                <td>
                                    /api/v0/power_strips
                                    <small class="float-right text-muted">Get all power strips</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-post td-method">POST</td>
                                <td>
                                    /api/v0/power_strips
                                    <small class="float-right text-muted">Store new power strip</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-put td-method">PUT</td>
                                <td>
                                    /api/v0/power_strips/{id}
                                    <small class="float-right text-muted">Update one power strip</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-get td-method">GET</td>
                                <td>
                                    /api/v0/power_strips/{id}
                                    <small class="float-right text-muted">Get one power strip</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-delete td-method">DELETE</td>
                                <td>
                                    /api/v0/power_strips/{id}
                                    <small class="float-right text-muted">Delete one power strip</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-post td-method">POST</td>
                                <td>
                                    /api/v0/power_strips/{id}/{plugName}
                                    <small class="float-right text-muted">Add new plug to one power strip</small>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h4>Plugs</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <h5>JSON Struct</h5>
                        <p>
                            { <br>
                            &nbsp;&nbsp;"id" : Integer Unique AutoGenerated, <br>
                            &nbsp;&nbsp;"name" : String Require, <small class="text-info">#The plug's name</small><br>
                            &nbsp;&nbsp;"state" : Boolean default=false, <small class="text-info">#The last known state, sent by the power strip (true/false => on/off)</small> <br>
                            &nbsp;&nbsp;"temp_state" : Boolean default=false, <small class="text-info">#The desired state (true/false => on/off)</small> <br>
                            &nbsp;&nbsp;"power_strip" : PowerStrip, <small class="text-info"></small>
                            <br>
                            }
                        </p>
                    </div>
                    <div class="col-md-12">
                        <h5>Rooting</h5>
                        <table class="table table-bordered">
                            <tbody>
                            <tr>
                                <td class="td-put td-method">PUT</td>
                                <td>
                                    /api/v0/plugs/{id}
                                    <small class="float-right text-muted">Update one plug</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-get td-method">GET</td>
                                <td>
                                    /api/v0/plugs/{id}
                                    <small class="float-right text-muted">Get one plug</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-get td-method">GET</td>
                                <td>
                                    /api/v0/plugs/{id}/states
                                    <small class="float-right text-muted">
                                        Get states for one plug -
                                        Return digits XY (X=current, Y=wanted)
                                    </small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-put td-method">PUT</td>
                                <td>
                                    /api/v0/plugs/{id}/actual/state/{actualState}
                                    <small class="float-right text-muted">Update current state (0/1 => OFF/ON)</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-put td-method">PUT</td>
                                <td>
                                    /api/v0/plugs/{id}/wanted/state/{wantedState}
                                    <small class="float-right text-muted">Update wanted state (0/1 => OFF/ON)</small>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h4>HTTP Header</h4>
            </div>
            <div class="card-body">
                <h5>X-Auth-Token</h5>
                <p>For login. You can find it on your <a href="{{ path('user_profile') }}">profile</a></p>

                <h5>Content-Type</h5>
                <p>
                    Must equals to '<b>application/json</b>' for <b>PUT</b> & <b>POST</b> methods. <br>
                    Equals to <b>text/css</b> for <b>GET</b> methods.
                </p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h4>Examples</h4>
            </div>
            <div class="card-body">
                <h5>Example JSON <small>(power strip)</small></h5>
                <pre><code class="json"><span id="powerStripStruct"></span></code></pre>

                <h5>
                    Python
                    <small><a href="http://docs.python-requests.org/en/master/user/quickstart/" target="_blank">More infos</a></small>
                </h5>
                <pre><code class="python"># How to use X-Auth-Token
url = 'https://smartplug.schmit.be/api/v0/some/endpoint'
headers = {
    'Content-Type' : 'application/json'
    'x-auth-token' : 'theToken',
}
r = requests.get(url, headers=headers)

# Set the current state of a plug (id=5) on ON
r = requests.put('https://smartplug.schmit.be/api/v0/plugs/5/actual/state/1')
                    </code></pre>

                <h5>
                    Swift
                    <small><a href="https://medium.com/@sdrzn/networking-and-persistence-with-json-in-swift-4-c400ecab402d" target="_blank">More infos</a></small>
                </h5>
                <pre><code class="swift">// Store a new power strip
var urlComponent = URLComponents()
urlComponent.scheme = "https"
urlComponent.host = "www.smartplug.schmit.be"
urlComponent.path = "/api/vO/power_strips"
// Param
let name = URLQueryItem(name: "name", value: "My First Power Strip")
urlComponent.queryItems = [name]

guard let url = urlComponent.url else {fatalError("URL not created")}

var request = URLRequest(url: url)
request.httpMethod = "POST"

var headers = request.allHTTPHeaderFields ?? [:]
headers["Content-Type"] = "application/json"
headers["X-Auth-Token"] = "theToken"
request.allHTTPHeaderFields = headers

//...</code></pre>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h4>HTTP Code</h4>
            </div>
            <div class="card-body">
                <ul class="list-group">
                    <li class="list-group-item"><span class="text-success">200</span> - OK</li>
                    <li class="list-group-item"><span class="text-danger">301</span> - Unauthorized - Invalid x-auth-token</li>
                    <li class="list-group-item"><span class="text-danger">303</span> - Forbidden - Valid token but forbidden resource</li>
                    <li class="list-group-item"><span class="text-danger">404</span> - Not Found</li>
                    <li class="list-group-item"><span class="text-danger">405</span> - Method Not Allowed</li>
                </ul>
            </div>
        </div>

    </div>

    <script src="{{ asset('assets/js/highlight.pack.js') }}"></script>

    <script>
        $(function () {
            var ps = {
                "id" : 1,
                "name" : "Example of name. Require",
                "plugs" : [
                    {
                        "id" : 1,
                        "name" : "Plug #1. Require",
                        "state" : true,
                        "tempState" : true
                    },
                    {
                        "id" : 2,
                        "name" : "Plug #2. Require",
                        "state" : false,
                        "tempState" : true
                    }
                ],
                "user" : {
                    "id" : 1,
                    "email" : "example@mail.com"
                }
            };

            $('#powerStripStruct').text(JSON.stringify(ps, null, 4));

        });
    </script>

    <script>hljs.initHighlightingOnLoad();</script>

{% endblock %}

